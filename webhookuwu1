getgenv().webhook = "WEBHOOK_HERE"
getgenv().lastExecutionTime = getgenv().lastExecutionTime or nil
getgenv().lastWebhookData = getgenv().lastWebhookData or nil
getgenv().cumulativeEarnedCash = getgenv().cumulativeEarnedCash or 0

local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local player = game.Players.LocalPlayer
local dataFolder = player:WaitForChild("DataFolder")

local function sendEmbedWithServerThumbnailAndCurrencyToDiscord()
    local webhookUrl = getgenv().webhook
    local serverThumbnailUrl = ""
    local currencyValue = dataFolder.Currency.Value
    local startingCash = getgenv().lastWebhookData and getgenv().lastWebhookData.currentCash or currencyValue
    local earnedCash = currencyValue - startingCash
    getgenv().cumulativeEarnedCash = getgenv().cumulativeEarnedCash + earnedCash
    local data = {
        embeds = {
            {
                title = "**VARSITYS AUTOFARM**",
                color = 65280,
                thumbnail = {
                    url = serverThumbnailUrl
                },
                description = "Cash Info\n\nStarting Cash: " .. string.format("$%s", tostring(startingCash):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")) ..
                "\n\nCurrent Cash: " .. string.format("$%s", tostring(currencyValue):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")) ..
                "\n\nEarned Cash: " .. string.format("$%s", tostring(getgenv().cumulativeEarnedCash):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", ""))
            }
        }
    }
    local headers = {
        ["Content-Type"] = "application/json"
    }
    local encodedData = HttpService:JSONEncode(data)
    local request = {
        Url = webhookUrl,
        Method = "POST",
        Headers = headers,
        Body = encodedData
    }
    getgenv().lastWebhookData = {
        currentCash = currencyValue
    }
    HttpService:RequestAsync(request)
end

RunService.Heartbeat:Connect(function()
    local interval = 60
    if not getgenv().lastExecutionTime or (tick() - getgenv().lastExecutionTime >= interval) then
        getgenv().lastExecutionTime = tick()
        sendEmbedWithServerThumbnailAndCurrencyToDiscord()
    end
end)
