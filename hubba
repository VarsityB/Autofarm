local function sendEmbedWithServerThumbnailAndCurrencyToDiscord()
    local webhookUrl = getgenv().webhook or ""
    local serverThumbnailUrl = "https://cdn.discordapp.com/icons/1193980576013750433/dbb27f6ecf1f5e6cdffeddd46f4cf717.png?size=1024"

    local formatCurrency = function(amount)
        return string.format("$%s", tostring(amount):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", ""))
    end

    local currencyValue = dataFolder.Currency.Value
    local startingCash = getgenv().lastWebhookData and getgenv().lastWebhookData.currentCash or currencyValue

    local earnedCash = currencyValue - startingCash
    getgenv().cumulativeEarnedCash = getgenv().cumulativeEarnedCash + earnedCash

    -- Calculate the elapsed time in minutes and seconds
    local elapsedTime = tick() - getgenv().lastExecutionTime
    local minutes = math.floor(elapsedTime / 60)
    local seconds = elapsedTime % 60

    local data = {
        embeds = {{
            title = "**VARSITYS AUTOFARM**",
            color = 0x9c8cfa,  -- Light Purple
            thumbnail = { url = serverThumbnailUrl },
            fields = {
                { name = "Elapsed Time", value = string.format("%d minutes %.2f seconds", minutes, seconds), inline = false }
            }
        }}
    }

    local headers = {
        ["Content-Type"] = "application/json"
    }

    local encodedData = HttpService:JSONEncode(data)

    local request = {
        Url = webhookUrl,
        Method = "POST",
        Headers = headers,
        Body = encodedData
    }

    -- Update last webhook data
    getgenv().lastWebhookData = {
        currentCash = currencyValue
    }

    -- Update last execution time
    getgenv().lastExecutionTime = tick()

    -- Send the embed message
    HttpService:RequestAsync(request)
end
